---
title: "Clustering algorithms"
output: html_notebook
---
### Install packages
```{r}
library(pacman)
p_load(ggplot2, usmap, rio, magrittr)
```


### Load data and set quantity of classes
```{r}
load("./income_elec_state.Rdata")
data <- as.data.frame(income_elec_state)
centers <- as.integer(4)
```

### That we have
```{r}
head(data)
```

### Clustering data by centers assigned up
```{r}
points <- kmeans(data, centers)
```


### Join class number to data fram
```{r}
cluster_data <- cbind(data, cluster = points$cluster)
```

### After clustering
```{r}
head(cluster_data)
```


### Extract data about centroids of clusters
```{r}
centroids <- aggregate(formula=cbind(income, elec) ~ cluster, 
                       data=cluster_data, 
                       FUN=mean)
```


### Extract index states from data frame
```{r}
states <- row.names(cluster_data)
```


### Plot our data
```{r}
ggplot(data=cluster_data, aes(x=income, y=elec, colour=factor(cluster))) +
  geom_point(shape=1) +
  geom_text(aes(label = states), hjust=0, vjust=-0.5) +
  geom_point(data = centroids, size=4, shape=8) +
  labs(color="Clusters", x="Income", y="Elec", title="Plot of clustering data")
```

### US map
```{r}
usmap_data <- cbind(cluster_data, state)
usmap_data$cluster <- as.factor(usmap_data$cluster)
plot_usmap(regions="states",
           data=as.data.frame(usmap_data),
           values="cluster",
           labels=TRUE) + 
  theme(legend.position="right") +
  labs(title="Clustering data by states")
```
## Experimant with value

```{r}
log_income <- log(data$income, base=10)
log_elec <- log(data$elec, base=10)

log_data <- as.data.frame(cbind(log_income, log_elec), row.names=states)

log_points <- kmeans(log_data, centers)

log_cluster_data <- cbind(log_data, cluster=log_points$cluster)

colnames(log_cluster_data) <- c("l_income", "l_elec", "l_cluster")

l_centroids <- aggregate(formula=cbind(l_income, l_elec) ~ l_cluster, 
                       data=log_cluster_data, 
                       FUN=mean)

head(log_cluster_data)
```


### Plot our data with modified data
```{r}
ggplot(data=log_cluster_data,  inherit.aes=FALSE, aes(x=l_income, y=l_elec, colour=factor(l_cluster))) +
  geom_point(shape=1) +
  geom_text(aes(label = states), hjust=0, vjust=-0.5) +
  geom_point(data=l_centroids, size=4, shape=8) +
  labs(color="Clusters", x="Income", y="Elec", title="Plot of clustering data")
```


# Hierarchical clustering
### Plot of source data
```{r}
hc <- data %>%
      dist %>%
      hclust

plot(hc)

rect.hclust(hc, k=4, border="red")
```
###Plot of log10 data
```{r}
l_hc <- log_data %>%
      dist %>%
      hclust

plot(l_hc)

rect.hclust(l_hc, k=4, border="red")
```


